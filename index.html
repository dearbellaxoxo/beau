<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Beau | Discipline is Elegance üå∑</title>
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@0,400;0,700;1,400&family=Quicksand:wght@300;500;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --baby-pink: #ffdae9;
            --ribbon-pink: #f48fb1;
            --soft-white: #ffffff;
            --lace-white: #fff5f8;
            --text-main: #7d5a5a;
            --lace-shadow: rgba(255, 182, 193, 0.4);
        }

        body {
            font-family: 'Quicksand', sans-serif;
            background-color: var(--baby-pink);
            background-image: url('https://www.transparenttextures.com/patterns/white-lace.png');
            color: var(--text-main); margin: 0; display: flex; flex-direction: column; height: 100vh; overflow: hidden;
            -webkit-tap-highlight-color: transparent;
        }

        h1, h2, h3, .serif { font-family: 'Playfair Display', serif; font-style: italic; text-align: center; }

        /* iPhone 13 Optimization: Centering & Padding */
        .card {
            background: rgba(255, 255, 255, 0.95); border-radius: 35px; padding: 20px; margin-bottom: 15px;
            position: relative; border: 2px solid white; width: 92%; box-sizing: border-box;
            box-shadow: 0 0 0 4px var(--lace-white), 0 10px 25px var(--lace-shadow);
            margin-left: auto; margin-right: auto;
        }
        
        .card::after { content: 'üéÄ'; position: absolute; top: -12px; right: 15px; font-size: 1.2rem; }

        header { background: var(--soft-white); padding: 15px 10px 10px 10px; text-align: center; border-bottom: 3px double var(--baby-pink); z-index: 10; position: relative; }
        header h1 { margin: 0; font-size: 1.6rem; color: var(--ribbon-pink); text-shadow: 1px 1px white; }
        .motto { font-size: 0.75rem; color: var(--ribbon-pink); margin-bottom: 5px; font-weight: bold; letter-spacing: 1px; text-transform: lowercase; }
        .daily-note { font-size: 0.75rem; color: #a18080; font-style: italic; min-height: 18px; margin-bottom: 8px; padding: 0 20px; line-height: 1.2; }

        .day-controls { display: flex; justify-content: center; align-items: center; gap: 20px; margin-bottom: 8px; }
        .day-btn { background: var(--lace-white); border: 1px solid var(--ribbon-pink); border-radius: 50%; width: 32px; height: 32px; cursor: pointer; color: var(--ribbon-pink); font-weight: bold; display: flex; align-items: center; justify-content: center; transition: 0.3s; }

        #viewport { flex: 1; overflow-y: auto; padding: 15px 0; display: flex; flex-direction: column; align-items: center; padding-bottom: 130px; }
        .screen, .view { display: none; width: 100%; animation: softFade 0.6s ease; }
        .active { display: block; }

        @keyframes softFade { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        /* Centering Checklist Items */
        .ritual-item { 
            display: flex; align-items: center; justify-content: center; 
            margin: 10px 0; font-size: 0.85rem; background: white; padding: 12px; 
            border-radius: 20px; border: 1px solid var(--baby-pink); text-align: center;
        }
        .ritual-item input[type="checkbox"] { margin-right: 12px; transform: scale(1.2); }
        
        .circle-container { position: relative; width: 190px; height: 190px; margin: 5px auto 15px auto; display: flex; align-items: center; justify-content: center; background: radial-gradient(circle, white 60%, var(--lace-white) 100%); border-radius: 50%; border: 4px double var(--baby-pink); }
        .progress-ring__circle { transform: rotate(-90deg); stroke: var(--ribbon-pink); stroke-dasharray: 565.48; stroke-dashoffset: 565.48; transition: 0.8s; stroke-linecap: round; }
        
        .water-grid { display: flex; justify-content: center; gap: 10px; margin-top: 15px; flex-wrap: wrap; padding: 0 10px; }
        .glass { font-size: 1.8rem; cursor: pointer; filter: grayscale(1); transition: 0.4s; opacity: 0.2; }
        .glass.filled { filter: grayscale(0); opacity: 1; transform: scale(1.1); }

        .graph-container { height: 100px; display: flex; align-items: flex-end; gap: 6px; border-bottom: 2px solid var(--baby-pink); padding: 20px 5px 5px 5px; margin: 10px 0; background: rgba(255,255,255,0.6); border-radius: 15px; }
        .graph-bar { background: var(--ribbon-pink); flex: 1; border-radius: 5px 5px 0 0; opacity: 0.7; position: relative; min-width: 20px; }
        .graph-bar::after { content: attr(data-val); position: absolute; top: -15px; left: 50%; transform: translateX(-50%); font-size: 0.55rem; color: var(--text-main); }

        nav { position: fixed; bottom: 0; width: 100%; background: rgba(255,255,255,0.98); display: none; justify-content: space-around; padding: 10px 0 35px 0; border-top: 2px solid var(--baby-pink); z-index: 100; box-shadow: 0 -5px 15px rgba(0,0,0,0.03); }
        .nav-btn { background: none; border: none; font-size: 1.4rem; cursor: pointer; filter: grayscale(1); opacity: 0.5; transition: 0.3s; padding: 10px; }
        .nav-btn.active { filter: grayscale(0); transform: translateY(-3px); opacity: 1; }

        input, select { border: none; border-bottom: 2px solid var(--baby-pink); background: transparent; text-align: center; padding: 10px; color: var(--text-main); font-family: 'Quicksand'; width: 85%; margin: 8px 0; outline: none; font-size: 1rem; }
        .next-btn { background: var(--ribbon-pink); color: white; border: 2px solid white; padding: 12px 35px; border-radius: 30px; cursor: pointer; font-weight: bold; margin-top: 15px; box-shadow: 0 4px 10px var(--lace-shadow); width: 80%; }

        .photo-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; }
        .photo-box { aspect-ratio: 3/4; background: var(--lace-white); border: 2px dashed var(--ribbon-pink); border-radius: 20px; display: flex; align-items: center; justify-content: center; font-size: 0.75rem; color: var(--ribbon-pink); cursor: pointer; overflow: hidden; position: relative; }
        .photo-box img { width: 100%; height: 100%; object-fit: cover; position: absolute; top: 0; left: 0; z-index: 2; }
        
        .history-card { background: white; border-radius: 25px; padding: 12px; margin-top: 15px; border: 1px solid var(--baby-pink); }
        .history-flex { display: flex; gap: 8px; margin-top: 8px; }
        .history-img { width: 50%; aspect-ratio: 3/4; border-radius: 15px; object-fit: cover; border: 1px solid var(--baby-pink); }

        /* Fix for scrollable meal list */
        #meal-list { max-height: 300px; overflow-y: auto; padding-right: 5px; }
    </style>
</head>
<body>

    <header id="main-header" style="display:none;">
        <div class="day-controls">
            <button class="day-btn" onclick="changeDay(-1)">‚Äπ</button>
            <span class="serif" id="display-date" style="font-size: 1.1rem;">Today</span>
            <button class="day-btn" onclick="changeDay(1)">‚Ä∫</button>
        </div>
        <h1 id="greet-name">Beau</h1>
        <div class="motto">discipline is elegance üå∑</div>
        <div class="daily-note" id="daily-reminder">...</div>
        <div id="streak-banner" style="font-size: 0.75rem; color: var(--ribbon-pink); font-weight: 500;">
            ü©∞ Streak: <span id="streak-val">0</span> | Grace: <span id="grace-val">0</span> 
            <button onclick="useGrace()" style="border:none; background:none; text-decoration:underline; font-size:0.7rem; cursor:pointer; color: var(--ribbon-pink); margin-left:10px;">+ Use Grace</button>
        </div>
    </header>

    <main id="viewport">
        <section id="screen-onboarding" class="screen active">
            <div class="card" style="text-align: center; margin-top: 20px;">
                <div id="q1" class="step-q active">
                    <p class="serif">What is your name, angel? üèπ</p>
                    <input type="text" id="in-name" placeholder="Name...">
                    <br><button class="next-btn" onclick="nextQ(2)">Next ü¶¢</button>
                </div>
                <div id="q2" class="step-q" style="display:none">
                    <p class="serif">Your current weight? (kg) ü©∞</p>
                    <input type="number" id="in-weight" placeholder="00.0" inputmode="decimal">
                    <br><button class="next-btn" onclick="nextQ(3)">Next üéÄ</button>
                </div>
                <div id="q3" class="step-q" style="display:none">
                    <p class="serif">Current waist size? (cm) ‚ú®</p>
                    <input type="number" id="in-waist" placeholder="00" inputmode="numeric">
                    <br><button class="next-btn" onclick="nextQ(4)">Next üèπ</button>
                </div>
                <div id="q4" class="step-q" style="display:none">
                    <p class="serif">Activity Level? üïäÔ∏è</p>
                    <select id="in-activity">
                        <option value="1.2">Sedentary</option>
                        <option value="1.375">Lightly Active</option>
                        <option value="1.55">Moderately Active</option>
                    </select>
                    <br><button class="next-btn" onclick="nextQ(5)">Next ü¶¢</button>
                </div>
                <div id="q5" class="step-q" style="display:none">
                    <p class="serif">Desired Silhouette? ü©∞</p>
                    <select id="in-body-goal">
                        <option value="slimming">Slim & Toned (Nicole/Meli)</option>
                        <option value="curvy">Hourglass (Daisy/Mia)</option>
                        <option value="sculpted">Athletic (Madfit/Chloe)</option>
                    </select>
                    <br><button class="next-btn" onclick="nextQ(6)">Next üéÄ</button>
                </div>
                <div id="q6" class="step-q" style="display:none">
                    <p class="serif">Goal Weight (kg)? üèπ</p>
                    <input type="number" id="in-goal-w" placeholder="Target weight" inputmode="decimal">
                    <br><button class="next-btn" onclick="nextQ(7)">Next ü¶¢</button>
                </div>
                <div id="q7" class="step-q" style="display:none">
                    <p class="serif">Your goal end date? üìÖ</p>
                    <input type="date" id="in-goal-d">
                    <br><button class="next-btn" onclick="finishOnboarding()">Start Journey üå∑</button>
                </div>
            </div>
        </section>

        <section id="screen-main" class="screen">
            <div id="view-home" class="view active">
                <div class="circle-container">
                    <svg class="progress-ring" width="180" height="180">
                        <circle class="progress-ring__circle" stroke-width="10" fill="transparent" r="80" cx="90" cy="90"/>
                    </svg>
                    <div style="position:absolute; text-align:center;">
                        <h2 id="circle-main" style="margin:0; font-size:2rem; color:var(--ribbon-pink);">0</h2>
                        <small class="serif">Remaining</small>
                        <div id="prot-count" style="font-size:0.75rem; font-weight:bold; color:var(--ribbon-pink); margin-top:5px;">0/0g Prot</div>
                    </div>
                </div>
                <div class="card">
                    <p class="serif" style="margin-top:0;">Daily Rituals Íí∑ ü©∞</p>
                    <div id="ritual-list"></div>
                </div>
            </div>

            <div id="view-food" class="view">
                <h2 class="serif">Gourmet Selection üçì</h2>
                <div class="card">
                    <input type="text" id="mealSearch" onkeyup="renderMeals()" placeholder="Search recipes..." style="width:100%; border-bottom-color: #eee;">
                    <div id="meal-list"></div>
                </div>
                <div class="card" style="text-align:center;">
                    <p class="serif" style="margin:0;">Hydration Tracker</p>
                    <div class="water-grid" id="water-tracker"></div>
                </div>
            </div>

            <div id="view-stats" class="view">
                <h2 class="serif">Your Progress üìà</h2>
                <div class="card">
                    <p class="serif" style="font-size:0.8rem; margin-bottom:5px;">Weight Journey (kg)</p>
                    <div class="graph-container" id="weight-graph"></div>
                    <p class="serif" style="font-size:0.8rem; margin: 15px 0 5px 0;">Waist Journey (cm)</p>
                    <div class="graph-container" id="waist-graph"></div>
                </div>
                <div class="card" style="text-align:center;">
                    <input type="number" id="up-w" placeholder="Update Weight" inputmode="decimal">
                    <input type="number" id="up-waist" placeholder="Update Waist" inputmode="numeric">
                    <button class="next-btn" style="width:100%;" onclick="updateStats()">Log Progress üèπ</button>
                </div>
            </div>

            <div id="view-sculpt" class="view">
                <h2 class="serif">Body Sculpting ü©∞</h2>
                <div class="card" style="text-align:center;">
                    <h3 id="daily-focus" class="serif" style="color:var(--ribbon-pink); margin-bottom:5px;">...</h3>
                    <p id="diff-week" style="font-size:0.7rem; font-weight:700; color: #a18080; margin-bottom:15px;"></p>
                    <div id="video-links"></div>
                </div>
            </div>

            <div id="view-photos" class="view">
                <h2 class="serif">Visual Vault üì∏</h2>
                <div class="card">
                    <div class="photo-grid">
                        <div class="photo-box" onclick="document.getElementById('f-front').click()">
                            <input type="file" id="f-front" hidden accept="image/*" onchange="preview(this, 'p-front')">
                            <img id="p-front" style="display:none"> <span id="t-front">Front üéÄ</span>
                        </div>
                        <div class="photo-box" onclick="document.getElementById('f-side').click()">
                            <input type="file" id="f-side" hidden accept="image/*" onchange="preview(this, 'p-side')">
                            <img id="p-side" style="display:none"> <span id="t-side">Side ü¶¢</span>
                        </div>
                    </div>
                    <button class="next-btn" style="width:100%;" onclick="savePhotos()">Save Weekly Vault</button>
                </div>
                <div id="photo-history" style="width: 100%;"></div>
            </div>

            <div id="view-settings" class="view">
                <h2 class="serif">Refinement ‚öôÔ∏è</h2>
                <div class="card" style="text-align:center;">
                    <p class="serif" style="font-size: 0.9rem;">Calorie Goal</p>
                    <input type="number" id="set-cals" inputmode="numeric">
                    <p class="serif" style="font-size: 0.9rem; margin-top:15px;">Protein Goal (g)</p>
                    <input type="number" id="set-prot" inputmode="numeric">
                    <button class="next-btn" style="width:100%;" onclick="saveSets()">Apply Changes üéÄ</button>
                </div>
            </div>
        </section>
    </main>

    <nav id="bottom-nav">
        <button class="nav-btn active" onclick="tab('home', this)">üè†</button>
        <button class="nav-btn" onclick="tab('food', this)">üçì</button>
        <button class="nav-btn" onclick="tab('stats', this)">üìà</button>
        <button class="nav-btn" onclick="tab('sculpt', this)">ü©∞</button>
        <button class="nav-btn" onclick="tab('photos', this)">üì∏</button>
        <button class="nav-btn" onclick="tab('settings', this)">‚öôÔ∏è</button>
    </nav>

    <script>
        let db = JSON.parse(localStorage.getItem('beau_final_v1')) || {
            setup: false, name: "", streak: 0, grace: 0, limit: 1400, prot: 70,
            history: {}, weights: [], waists: [], offset: 0, photos: [], focus: "slimming"
        };

        const creators = [
            {n:"Mia Green", u:"https://www.youtube.com/@miagreen"},
            {n:"Madfit", u:"https://www.youtube.com/@MadFit"},
            {n:"Daisy Keech", u:"https://www.youtube.com/@DaisyKeech"},
            {n:"Hailey C", u:"https://www.youtube.com/@HaileyC"},
            {n:"Nicole Pilates", u:"https://www.youtube.com/@NicolePilates"},
            {n:"Lovefrommeli", u:"https://www.youtube.com/@Lovefrommeli"},
            {n:"Chloe Ting", u:"https://www.youtube.com/@ChloeTing"}
        ];

        const focuses = [
            "Glutes & Deep Core üçë", "Pelvic Floor & Full Body ü¶¢", "Waist Cincher & Abs üéÄ",
            "Lean Arms & Posture ü©∞", "Inner Thighs & Pilates üèπ", "Full Body HIIT Burn üî•", "Stretch & Recovery üïäÔ∏è"
        ];

        const recipes = [
            {n:"Berry Protein Shake", c:220, p:25}, {n:"Vanilla Proats", c:310, p:20}, {n:"Avo Egg Toast", c:280, p:18},
            {n:"Greek Yogurt Bowl", c:190, p:22}, {n:"Lean Chicken Salad", c:350, p:35}, {n:"Salmon & Greens", c:410, p:30},
            {n:"Cottage Cheese Pancakes", c:290, p:24}, {n:"Turkey Wraps", c:320, p:28}, {n:"Shrimp Zoodles", c:250, p:26},
            {n:"Tofu Scramble", c:240, p:20}, {n:"White Fish Bake", c:300, p:32}, {n:"Beef Stir Fry", c:450, p:38},
            {n:"Lentil Soup", c:280, p:15}, {n:"Quinoa Salad", c:340, p:12}, {n:"Protein Coffee", c:120, p:15},
            {n:"Boiled Eggs & Fruit", c:180, p:13}, {n:"Tuna Melt (Light)", c:330, p:29}, {n:"Chia Pudding", c:210, p:10},
            {n:"Miso Glazed Salmon", c:380, p:30}, {n:"Lemon Chicken", c:310, p:35}, {n:"Edamame Bowl", c:220, p:18},
            {n:"Egg White Omelet", c:160, p:20}, {n:"Skyr & Honey", c:150, p:20}, {n:"Hummus & Veggies", c:200, p:8},
            {n:"Poke Bowl", c:420, p:28}, {n:"Ricotta Toast", c:240, p:12}, {n:"Baked Cod", c:270, p:30},
            {n:"Lean Chili", c:390, p:33}, {n:"Peanut Butter Apple", c:190, p:5}, {n:"Protein Brownie", c:150, p:12}
        ];

        const notes = ["Discipline is elegance. üå∑", "You are blooming beautifully. üéÄ", "Small steps, big glow. üèπ", "Stay soft, stay strong. ü¶¢", "Your future self is thanking you. ‚ú®"];

        function nextQ(n) {
            document.querySelectorAll('.step-q').forEach(s => s.style.display = 'none');
            document.getElementById('q'+n).style.display = 'block';
        }

        function finishOnboarding() {
            db.name = document.getElementById('in-name').value || "Angel";
            db.focus = document.getElementById('in-body-goal').value;
            const w = parseFloat(document.getElementById('in-weight').value) || 60;
            const wa = parseFloat(document.getElementById('in-waist').value) || 70;
            db.weights.push({v:w, d:new Date().toLocaleDateString()});
            db.waists.push({v:wa, d:new Date().toLocaleDateString()});
            db.setup = true;
            save(); render();
        }

        function getDay() {
            const k = "d_"+db.offset;
            if(!db.history[k]) db.history[k] = {c:0, p:0, w:0, r:[false,false,false,false], done:false};
            return db.history[k];
        }

        function render() {
            if(!db.setup) return;
            document.getElementById('screen-onboarding').style.display = 'none';
            document.getElementById('screen-main').style.display = 'block';
            document.getElementById('main-header').style.display = 'block';
            document.getElementById('bottom-nav').style.display = 'flex';
            
            document.getElementById('greet-name').innerText = "Beau, " + db.name;
            document.getElementById('daily-reminder').innerText = notes[Math.abs(db.offset + new Date().getDate()) % notes.length];
            
            const day = getDay();
            document.getElementById('circle-main').innerText = Math.max(0, db.limit - day.c);
            document.getElementById('prot-count').innerText = `${day.p}/${db.prot}g Prot`;
            
            const ring = document.querySelector('.progress-ring__circle');
            const off = 502.65 - (Math.min(1, day.c/db.limit) * 502.65); // Circle circumference adjust
            ring.style.strokeDashoffset = off;

            const rituals = ["Sculpting Session ü©∞", "8 Glasses Water ü•õ", "Nourishment Goal üçì", "Self Care Moment üåô"];
            document.getElementById('ritual-list').innerHTML = rituals.map((r,i) => `
                <div class="ritual-item">
                    <input type="checkbox" ${day.r[i]?'checked':''} onchange="checkRitual(${i})">
                    <span>${r}</span>
                </div>
            `).join('');

            document.getElementById('streak-val').innerText = db.streak;
            document.getElementById('grace-val').innerText = db.grace;
            
            renderWater(day);
            renderGraphs();
            renderMeals();
            renderSculpt();
            renderHistory();
            
            document.getElementById('set-cals').value = db.limit;
            document.getElementById('set-prot').value = db.prot;
        }

        function renderWater(day) {
            const h = document.getElementById('water-tracker');
            h.innerHTML = "";
            for(let i=1; i<=8; i++) {
                let s = document.createElement('span');
                s.className = `glass ${i<=day.w?'filled':''}`;
                s.innerText = "ü•õ";
                s.onclick = () => { day.w = i; save(); render(); };
                h.appendChild(s);
            }
        }

        function renderGraphs() {
            const draw = (id, data) => {
                const container = document.getElementById(id);
                if(!data || !data.length) return;
                const vals = data.map(x => x.v);
                const max = Math.max(...vals) + 1;
                const min = Math.min(...vals) - 1;
                container.innerHTML = data.slice(-7).map(x => `
                    <div class="graph-bar" style="height:${((x.v-min)/(max-min))*100}%" data-val="${x.v}"></div>
                `).join('');
            };
            draw('weight-graph', db.weights);
            draw('waist-graph', db.waists);
        }

        function renderSculpt() {
            const dayIdx = Math.abs(db.offset);
            const weekNum = Math.floor(dayIdx / 7) + 1;
            const creator = creators[dayIdx % 7];
            document.getElementById('daily-focus').innerText = focuses[dayIdx % 7];
            document.getElementById('diff-week').innerText = "Difficulty: Week " + weekNum + (weekNum > 2 ? " (HIIT Mode)" : "");
            document.getElementById('video-links').innerHTML = `
                <div class="ritual-item" style="flex-direction: column; gap: 10px;">
                    <div><b>Profile: ${creator.n}</b></div>
                    <a href="${creator.u}" target="_blank" style="color:var(--ribbon-pink); text-decoration:none; font-weight:bold; background: var(--lace-white); padding: 8px 20px; border-radius: 15px;">Open YouTube Profile ‚ñ∂Ô∏è</a>
                </div>
            `;
        }

        function renderMeals() {
            const q = document.getElementById('mealSearch').value.toLowerCase();
            document.getElementById('meal-list').innerHTML = recipes.filter(r => r.n.toLowerCase().includes(q)).map(r => `
                <div class="ritual-item" onclick="addFood(${r.c}, ${r.p})" style="cursor:pointer; justify-content: space-between;">
                    <div style="text-align: left;">${r.n} <br><small>${r.p}g Prot</small></div>
                    <span style="color:var(--ribbon-pink); font-weight:bold;">+${r.c}</span>
                </div>
            `).join('');
        }

        function checkRitual(i) {
            const day = getDay();
            day.r[i] = !day.r[i];
            if(day.r.every(x => x === true) && !day.done) {
                day.done = true; db.streak++;
            } else if (!day.r.every(x => x === true) && day.done) {
                day.done = false; db.streak = Math.max(0, db.streak - 1);
            }
            save(); render();
        }

        function addFood(c, p) { const d = getDay(); d.c += c; d.p += p; save(); render(); }
        
        function updateStats() {
            const w = document.getElementById('up-w').value;
            const wa = document.getElementById('up-waist').value;
            if(w) db.weights.push({v:parseFloat(w), d:new Date().toLocaleDateString()});
            if(wa) db.waists.push({v:parseFloat(wa), d:new Date().toLocaleDateString()});
            save(); render();
            document.getElementById('up-w').value = ""; document.getElementById('up-waist').value = "";
        }

        function saveSets() {
            db.limit = parseInt(document.getElementById('set-cals').value);
            db.prot = parseInt(document.getElementById('set-prot').value);
            save(); render();
            alert("Settings updated! üéÄ");
        }

        function changeDay(n) { db.offset += n; document.getElementById('display-date').innerText = db.offset==0?"Today":"Day "+db.offset; render(); }
        function useGrace() { db.grace++; db.streak++; save(); render(); }
        
        function tab(v, b) { 
            document.querySelectorAll('.view').forEach(x => x.classList.remove('active')); 
            document.getElementById('view-'+v).classList.add('active'); 
            document.querySelectorAll('.nav-btn').forEach(x => x.classList.remove('active'));
            b.classList.add('active');
        }

        function preview(input, id) {
            const reader = new FileReader();
            reader.onload = e => { 
                const img = document.getElementById(id);
                img.src = e.target.result; 
                img.style.display = 'block';
                const labelId = id === 'p-front' ? 't-front' : 't-side';
                document.getElementById(labelId).style.display = 'none';
            };
            reader.readAsDataURL(input.files[0]);
        }

        function savePhotos() {
            const f = document.getElementById('p-front').src;
            const s = document.getElementById('p-side').src;
            if(!f || f.includes('none') || !s || s.includes('none')) return alert("Upload both photos first! üéÄ");
            db.photos.unshift({f, s, d: new Date().toLocaleDateString()});
            save();
            renderHistory();
            // Reset
            document.getElementById('p-front').style.display = 'none';
            document.getElementById('p-side').style.display = 'none';
            document.getElementById('t-front').style.display = 'block';
            document.getElementById('t-side').style.display = 'block';
            alert("Weekly entry saved to your vault! üì∏");
        }

        function renderHistory() {
            const container = document.getElementById('photo-history');
            if(!db.photos || !db.photos.length) {
                container.innerHTML = "<p style='text-align:center; font-size:0.75rem; opacity:0.5; margin-top:20px;'>Your visual vault is empty.</p>";
                return;
            }
            container.innerHTML = "<h3 class='serif' style='font-size: 1rem; margin-top: 25px;'>Vault History</h3>" + db.photos.map(p => `
                <div class="history-card">
                    <small class="serif">${p.d}</small>
                    <div class="history-flex">
                        <img src="${p.f}" class="history-img">
                        <img src="${p.s}" class="history-img">
                    </div>
                </div>
            `).join('');
        }

        function save() { localStorage.setItem('beau_final_v1', JSON.stringify(db)); }
        window.onload = render;
    </script>
</body>
</html>
